#! /usr/bin/env ruby

require "rubygems"
require "daemons"
require "optparse"
require File.expand_path("../lib/beetle", File.dirname(__FILE__))

Daemons.run_proc("redis_configuration_client", :multiple => true, :log_output => true) do
  opts = OptionParser.new 
  opts.on("-r", "--redis-servers host1:port1,host2:port2,...", String) do |val|
    Beetle.config.redis_hosts = val || "localhost:6379, localhost:6380"
  end
  opts.parse!

  Beetle.config.servers = "localhost:5672, localhost:5673"

  # set Beetle log level to info, less noisy than debug
  Beetle.config.logger.level = Logger::INFO

  Beetle::RedisConfigurationClient.new.start
end
